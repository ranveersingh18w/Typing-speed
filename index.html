<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- New "Cyber Grid" Theme --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0c22;
            background-image: 
                linear-gradient(rgba(13, 12, 34, 0.95), rgba(13, 12, 34, 0.95)),
                linear-gradient(0deg, rgba(0, 245, 212, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 245, 212, 0.05) 1px, transparent 1px);
            background-size: 100%, 30px 30px, 30px 30px;
            overflow-x: hidden;
        }
        .hidden { display: none; }
        .correct { color: #00ffc3; } /* Bright Cyan/Green */
        .incorrect { color: #ff33a8; } /* Hot Pink */
        
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .current { position: relative; }
        .current::before {
            content: ''; position: absolute; left: -1px; top: 10%;
            height: 80%; width: 2px; background-color: #00f5d4; /* Neon Cyan */
            animation: blink 1s infinite; border-radius: 2px;
        }
        
        #text-container {
            height: 7.5rem; overflow: hidden; position: relative;
            -webkit-mask-image: linear-gradient(to bottom, black 66%, transparent 100%);
            mask-image: linear-gradient(to bottom, black 66%, transparent 100%);
        }
        #text-to-type {
            font-size: 1.5rem; line-height: 2.5rem; letter-spacing: 0.025em;
            color: #a7aed0; /* Light lavender */
            transition: transform 0.3s ease-out;
            position: relative;
            white-space: pre-wrap; 
            word-break: keep-all;
        }

        #user-input { caret-color: transparent; color: transparent; }
        #user-input::selection { background: transparent; }
        #user-input::-moz-selection { background: transparent; }

        .glass-container {
            background: rgba(13, 12, 34, 0.7); backdrop-filter: blur(10px);
            border: 1px solid #ff33a8;
            box-shadow: 0 0 20px rgba(255, 51, 168, 0.3);
        }
        .primary-btn {
            background: linear-gradient(45deg, #ff33a8, #e94560);
            box-shadow: 0 0 15px rgba(255, 51, 168, 0.5); transition: all 0.3s ease;
        }
        .primary-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 0 25px rgba(255, 51, 168, 0.8);
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 10px #00f5d4; } 50% { box-shadow: 0 0 20px #00f5d4; } }
        #timer-container {
            width: 60px; height: 60px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 1.25rem; color: white;
            background: rgba(15, 52, 96, 0.7); animation: pulse 2s infinite;
            border: 1px solid #00f5d4;
        }

        #keyboard-container { margin-top: 2rem; }
        #keyboard { display: flex; flex-direction: column; gap: 0.5rem; align-items: center; }
        .keyboard-row { display: flex; justify-content: center; gap: 0.5rem; }
        .key {
            position: relative; color: #0d0c22; border-radius: 0.375rem; font-weight: 600;
            width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;
            text-transform: uppercase; border-bottom: 3px solid rgba(0,0,0,0.2);
            transition: all 0.1s ease;
        }
        .key.key-space { width: 400px; }

        .key-color-cyan { background-color: #00f5d4; } .key-color-purple { background-color: #9d63e0; }
        .key-color-pink { background-color: #ff2a6d; } .key-color-orange { background-color: #ff7f11; }
        .key-color-yellow { background-color: #f7b801; } .key-color-green { background-color: #39ff14; }
        .key-color-peach { background-color: #ff66c4; } .key-color-space { background-color: #e94560; }
        
        .key.highlight::before {
            content: ''; position: absolute; left: 50%; top: 50%;
            transform: translate(-50%, -50%); width: 120%; height: 120%;
            background: white; border-radius: 0.5rem; filter: blur(15px);
            opacity: 0.8; z-index: -1; transition: opacity 0.2s;
        }
        .key.pressed { transform: scale(0.95); border-bottom-width: 1px; }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-5xl mx-auto p-4 md:p-6 text-center">
        <!-- Setup Screen -->
        <div id="setup-screen" class="fade-in">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">Typing Speed Test</h1>
            <p class="text-lg text-gray-400 mb-8">Select a test duration to begin.</p>
            <div class="flex flex-wrap justify-center gap-4">
                <button data-time="20" class="time-btn primary-btn text-white font-bold py-3 px-6 rounded-lg text-lg">20s</button>
                <button data-time="60" class="time-btn primary-btn text-white font-bold py-3 px-6 rounded-lg text-lg">1m</button>
                <button data-time="300" class="time-btn primary-btn text-white font-bold py-3 px-6 rounded-lg text-lg">5m</button>
                <button data-time="600" class="time-btn primary-btn text-white font-bold py-3 px-6 rounded-lg text-lg">10m</button>
            </div>
        </div>

        <!-- Test Screen -->
        <div id="test-screen" class="hidden">
            <header class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-white">Typing Speed Test</h1>
                <div id="timer-container"><span id="timer">0s</span></div>
            </header>
            <div id="text-container" class="glass-container p-6 rounded-lg mb-6">
                <div id="text-to-type" class="select-none"></div>
                <textarea id="user-input" class="absolute top-0 left-0 w-full h-full p-6 bg-transparent resize-none outline-none" spellcheck="false" autocorrect="off" autocapitalize="off"></textarea>
            </div>
            <div class="flex justify-center gap-4 mb-4">
                <button id="back-btn" class="secondary-btn bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-5 rounded-lg transition-all">Back</button>
                <button id="end-test-btn" class="secondary-btn bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-5 rounded-lg transition-all">End Test</button>
            </div>
            <div id="keyboard-container"><div id="keyboard"></div></div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden"></div>
    </div>
    
    <script>
        // This file contains the text passages for the typing test.
        const textSource = [
            "The quick brown fox jumps over the lazy dog. This classic sentence is used to test typewriters and computer keyboards because it contains all the letters of the English alphabet.",
            "Technology has revolutionized the way we live and work. From smartphones to artificial intelligence, innovation continues to shape our future and present new challenges and opportunities.",
            "The sun dipped below the horizon, painting the sky in hues of orange and purple. A gentle breeze rustled the leaves of the trees, creating a soothing melody for the evening.",
            "To be successful, you must be willing to put in the hard work and dedication. There are no shortcuts to achieving your goals. Stay focused, remain persistent, and never lose sight.",
            "Reading is a fundamental skill that opens up a world of knowledge and imagination. Whether you enjoy fiction, non-fiction, or poetry, books have the power to transport you to new places.",
            "The world of finance is complex and ever-changing. Markets fluctuate based on a variety of factors, from economic reports to global events. Investors must be vigilant and informed.",
            "The importance of a healthy lifestyle cannot be overstated. A balanced diet, regular exercise, and adequate sleep are the pillars of well-being, contributing to both physical and mental health.",
            "The journey of a thousand miles begins with a single step. This ancient proverb reminds us that every great achievement starts with a small, manageable action. Do not be intimidated.",
            "Creativity is the engine of progress. It allows us to solve problems in new ways and to create things that have never existed before. Nurture your creative spirit, for it is a precious resource.",
            "In the heart of the city, life moves at a relentless pace. Sirens wail in the distance, crowds bustle along the sidewalks, and skyscrapers reach for the clouds, creating a vibrant tapestry of human activity.",
            "History is not just a study of the past, but a guide for the future. By understanding the mistakes and triumphs of those who came before us, we can make better decisions for ourselves and for society.",
            "The vastness of space has always captivated the human imagination. From the twinkling stars to the swirling galaxies, the cosmos invites us to explore and to wonder about our place in the universe.",
            "Music has a unique power to evoke emotions and to connect people across cultures. A simple melody can bring joy, comfort, or a sense of shared experience, transcending language barriers.",
            "The principles of science provide a framework for understanding the natural world. Through observation, experimentation, and critical thinking, we can uncover the laws that govern the universe.",
            "Learning a new language opens up a new world of communication and understanding. It allows you to connect with different people, experience new cultures, and see the world from a new perspective.",
            "The art of cooking is a blend of creativity and precision. It involves combining flavors, textures, and aromas to create dishes that are both delicious and nourishing. A shared meal can be a powerful bond.",
            "Climate change is one of the most pressing issues of our time. It requires a global effort to reduce emissions, transition to renewable energy, and protect our planet for future generations.",
            "The internet has transformed the way we access information and connect with one another. It has created a global village where ideas can be shared instantly, but it also presents new challenges.",
            "The beauty of nature can be found in the smallest details, from the intricate patterns of a snowflake to the vibrant colors of a butterfly's wings. Taking time to appreciate these wonders can be a source of peace.",
            "A good story can transport you to another world. It can make you laugh, cry, and think about the world in new ways. The power of storytelling is a fundamental part of the human experience."
        ];
    </script>
    
    <script>
        // --- DOM Elements ---
        const setupScreen = document.getElementById('setup-screen');
        const testScreen = document.getElementById('test-screen');
        const resultScreen = document.getElementById('result-screen');
        const textToTypeElement = document.getElementById('text-to-type');
        const userInputElement = document.getElementById('user-input');
        const timerElement = document.getElementById('timer');
        
        // --- Keyboard Data ---
        const keyboardLayout = [
            ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
            ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
            ['z', 'x', 'c', 'v', 'b', 'n', 'm'],
            [' ']
        ];
        const keyColorMapping = {
            'q': 'cyan', 'w': 'purple', 'e': 'pink', 'r': 'orange', 't': 'orange', 'y': 'yellow', 'u': 'yellow', 'i': 'green', 'o': 'peach', 'p': 'peach',
            'a': 'cyan', 's': 'purple', 'd': 'pink', 'f': 'orange', 'g': 'orange', 'h': 'yellow', 'j': 'yellow', 'k': 'green', 'l': 'peach',
            'z': 'cyan', 'x': 'purple', 'c': 'pink', 'v': 'orange', 'b': 'orange', 'n': 'yellow', 'm': 'yellow',
            ' ': 'space'
        };

        // --- State Variables ---
        let testDuration = 0, timerInterval, testActive = false, timeRemaining = 0;
        let lastHighlightedKey = null;
        let wpm = 0, accuracy = 100, errors = 0, typedChars = 0;
        let currentLine = 0;
        let characterSpans = []; 
        let isUpdatePending = false;

        // --- Core Functions ---
        function createKeyboard() {
            const keyboardDiv = document.getElementById('keyboard');
            keyboardDiv.innerHTML = '';
            keyboardLayout.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';
                row.forEach(key => {
                    const keyDiv = document.createElement('div');
                    keyDiv.textContent = key;
                    keyDiv.className = 'key';
                    keyDiv.dataset.key = key.toLowerCase();
                    const color = keyColorMapping[key] || '';
                    if (color) keyDiv.classList.add(`key-color-${color}`);
                    if (key === ' ') {
                        keyDiv.classList.add('key-space');
                        keyDiv.textContent = 'Space';
                    }
                    rowDiv.appendChild(keyDiv);
                });
                keyboardDiv.appendChild(rowDiv);
            });
        }
        
        function initializeTest(duration) {
            testDuration = duration;
            timeRemaining = duration;
            testActive = false;
            clearInterval(timerInterval);
            userInputElement.value = '';
            userInputElement.disabled = false;
            currentLine = 0;
            textToTypeElement.style.transform = `translateY(0px)`;

            timerElement.textContent = `${timeRemaining}s`;
            wpm = 0; accuracy = 100; errors = 0; typedChars = 0;
            
            let longPassage = '';
            for (let i=0; i < 20; i++) { 
                longPassage += textSource.sort(() => 0.5 - Math.random()).join(' ') + ' ';
            }
            let passage = longPassage.toLowerCase();

            textToTypeElement.innerHTML = ''; 
            passage.split('').forEach(char => {
                const charSpan = document.createElement('span');
                charSpan.textContent = char;
                textToTypeElement.appendChild(charSpan);
            });
            characterSpans = Array.from(textToTypeElement.querySelectorAll('span')); 
            
            setupScreen.classList.add('hidden');
            resultScreen.innerHTML = '';
            resultScreen.classList.add('hidden');
            testScreen.classList.remove('hidden');
            testScreen.classList.add('fade-in');

            updateHighlighting(); 
            userInputElement.focus();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                timerElement.textContent = `${timeRemaining}s`;
                if (timeRemaining <= 0) {
                    endTest();
                }
            }, 1000);
        }

        function updateHighlighting() {
            const typedText = userInputElement.value;
            const currentPosition = typedText.length;
            const lastPosition = currentPosition - 1;

            if (lastPosition >= 0 && characterSpans[lastPosition]) {
                const span = characterSpans[lastPosition];
                span.classList.remove('current');
                if (span.textContent === typedText[lastPosition]) {
                    span.className = 'correct';
                } else {
                    span.className = 'incorrect';
                }
            }
            
            const currentSpan = characterSpans[currentPosition];
            if (currentSpan) {
                currentSpan.className = 'current';
                
                const lineHeight = parseFloat(getComputedStyle(textToTypeElement).lineHeight);
                const spanLineIndex = Math.floor(currentSpan.offsetTop / lineHeight);

                if (spanLineIndex > currentLine) {
                    currentLine = spanLineIndex;
                    if (currentLine > 0) {
                        const offset = -(currentLine - 1) * lineHeight;
                        textToTypeElement.style.transform = `translateY(${offset}px)`;
                    }
                }
            }

            if (lastHighlightedKey) lastHighlightedKey.classList.remove('highlight');
            const nextChar = currentSpan?.textContent.toLowerCase() || '';
            const keyElement = document.querySelector(`.key[data-key="${nextChar}"]`);
            if (keyElement) {
                keyElement.classList.add('highlight');
                lastHighlightedKey = keyElement;
            }
        }

        function calculateStats() {
            const typedText = userInputElement.value;
            typedChars = typedText.length;
            
            errors = 0;
            typedText.split('').forEach((char, index) => {
                if(characterSpans[index] && char !== characterSpans[index].textContent){
                    errors++;
                }
            });

            accuracy = typedChars > 0 ? Math.round(((typedChars - errors) / typedChars) * 100) : 100;
            const elapsedTimeInMinutes = (testDuration - timeRemaining) / 60;
            wpm = elapsedTimeInMinutes > 0 ? Math.round((typedChars / 5) / elapsedTimeInMinutes) : 0;
        }

        function endTest() {
            if (!testActive && userInputElement.value.length === 0) return;
            
            clearInterval(timerInterval);
            testActive = false;
            userInputElement.disabled = true;
            calculateStats();

            const typedText = userInputElement.value;
            const typedWords = typedText.trim().split(/\s+/).filter(w => w.length > 0);
            
            let incorrectWordsCount = 0;
            typedWords.forEach((word, index) => {
                const sourceWord = textToTypeElement.textContent.trim().split(/\s+/)[index];
                if (word !== sourceWord) {
                    incorrectWordsCount++;
                }
            });
            
            resultScreen.innerHTML = `
                <div class="glass-container p-8 rounded-lg max-w-lg mx-auto fade-in">
                    <h2 class="text-3xl font-bold mb-4 text-white">Test Complete!</h2>
                    <div class="grid grid-cols-2 gap-4 text-left mb-8">
                        <div><p class="text-gray-400">Speed (WPM)</p><p class="text-4xl font-bold text-cyan-400">${wpm}</p></div>
                        <div><p class="text-gray-400">Accuracy</p><p class="text-4xl font-bold">${accuracy}%</p></div>
                        <div><p class="text-gray-400">Typed Chars</p><p class="text-4xl font-bold">${typedChars}</p></div>
                        <div><p class="text-gray-400">Incorrect Words</p><p class="text-4xl font-bold text-red-400">${incorrectWordsCount}</p></div>
                    </div>
                    <button id="new-test-btn" class="primary-btn text-white font-bold py-3 px-6 rounded-lg w-full text-lg">Start New Test</button>
                </div>`;
            
            document.getElementById('new-test-btn').addEventListener('click', resetToSetup);
            testScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
        }

        function resetToSetup() {
            resultScreen.classList.add('hidden');
            testScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
            setupScreen.classList.add('fade-in');
            clearInterval(timerInterval);
        }

        function handleInput() {
            if (!isUpdatePending) {
                isUpdatePending = true;
                requestAnimationFrame(() => {
                    if (!testActive && userInputElement.value.length > 0) {
                        testActive = true;
                        startTimer();
                    }
                    if (testActive) {
                        updateHighlighting();
                        calculateStats();
                    }
                    isUpdatePending = false;
                });
            }
        }

        function handleKeyPress(e) {
            let key = e.key.toLowerCase();
            const keyElement = document.querySelector(`.key[data-key="${key}"]`);
            if (keyElement) {
                if (e.type === 'keydown') {
                    keyElement.classList.add('pressed');
                } else {
                    keyElement.classList.remove('pressed');
                }
            }
        }
        
        window.addEventListener('load', () => {
            const timeButtons = document.querySelectorAll('.time-btn');
            const endTestBtn = document.getElementById('end-test-btn');
            const backBtn = document.getElementById('back-btn');
            
            timeButtons.forEach(button => button.addEventListener('click', () => initializeTest(parseInt(button.dataset.time))));
            userInputElement.addEventListener('input', handleInput);
            endTestBtn.addEventListener('click', endTest);
            backBtn.addEventListener('click', resetToSetup);
            
            document.addEventListener('keydown', handleKeyPress);
            document.addEventListener('keyup', handleKeyPress);

            createKeyboard();
        });
    </script>
</body>
</html>
